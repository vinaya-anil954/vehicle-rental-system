{% extends "base.html" %}
{% block title %}Book Vehicle{% endblock %}

{% block content %}
<div class="booking-container">
    <h2>Book {{ vehicle[2] }} {{ vehicle[1] }}</h2>
    <p>Price: ${{ "%.2f"|format(vehicle[3]) }}/day</p>
    
    <form method="POST" id="bookingForm" action="{{ url_for('book_vehicle', vehicle_id=vehicle[0]) }}">
        <div class="form-group">
            <label for="start_date">From:</label>
            <input type="date" id="start_date" name="start_date" required 
                   min="{{ datetime.now().strftime('%Y-%m-%d') }}">
        </div>
        
        <div class="form-group">
            <label for="end_date">To:</label>
            <input type="date" id="end_date" name="end_date" required 
                   min="{{ datetime.now().strftime('%Y-%m-%d') }}">
        </div>
        
        <div class="form-group">
            <label>Total Price:</label>
            <div id="total_price">$0.00</div>
            <input type="hidden" id="calculated_price" name="calculated_price" value="0">
        </div>
        
        <button type="submit" class="btn btn-primary">Confirm Booking</button>
    </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const startDateInput = document.getElementById("start_date");
    const endDateInput = document.getElementById("end_date");
    const totalPriceDisplay = document.getElementById("total_price");
    const calculatedPriceInput = document.getElementById("calculated_price");
    const pricePerDay = {{ vehicle[3] }};
    
    function calculateTotal() {
        const startDate = new Date(startDateInput.value);
        const endDate = new Date(endDateInput.value);
        
        if (startDate && endDate) {
            const timeDiff = endDate - startDate;
            const days = Math.ceil(timeDiff / (1000 * 60 * 60 * 24)) + 1;
            
            if (days <= 0) {
                totalPriceDisplay.textContent = 'Invalid date range';
                calculatedPriceInput.value = '0';
                return false;
            }
            
            const total = days * pricePerDay;
            totalPriceDisplay.textContent = '$' + total.toFixed(2);
            calculatedPriceInput.value = total.toFixed(2);
            return true;
        }
        return false;
    }
    
    startDateInput.addEventListener('change', function() {
        if (startDateInput.value) {
            endDateInput.min = startDateInput.value;
            if (endDateInput.value && endDateInput.value < startDateInput.value) {
                endDateInput.value = '';
            }
        }
        calculateTotal();
    });
    
    endDateInput.addEventListener('change', calculateTotal);
    
    document.getElementById("bookingForm").addEventListener("submit", function(e) {
        if (!calculateTotal() || parseFloat(calculatedPriceInput.value) <= 0) {
            e.preventDefault();
            alert('Please select valid dates for booking');
        }
    });
});
</script>

<style>
    .booking-container {
        max-width: 500px;
        margin: 20px auto;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .form-group {
        margin-bottom: 15px;
    }
    label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
    }
    input[type="date"] {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    #total_price {
        font-size: 1.2em;
        font-weight: bold;
        color: #2a6496;
        margin: 10px 0;
    }
    .btn-primary {
        background-color: #2a6496;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .btn-primary:hover {
        background-color: #1d4b75;
    }
</style>
{% endblock %}